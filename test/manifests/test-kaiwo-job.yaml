apiVersion: kaiwo.ai/v1alpha1
kind: KaiwoJob
metadata:
  name: test-kaiwo-gpu-job
  labels:
    app: kaiwo-test
spec:
  image: rocm/pytorch:latest
  gpus: 1
  replicas: 1
  entrypoint: |
    python -c "
import torch
import os
print('=== Kaiwo-PoC GPU Test ===')
print(f'CUDA available: {torch.cuda.is_available()}')
print(f'GPU count: {torch.cuda.device_count()}')
if torch.cuda.is_available():
    for i in range(torch.cuda.device_count()):
        print(f'GPU {i} name: {torch.cuda.get_device_name(i)}')
        print(f'GPU {i} memory: {torch.cuda.get_device_properties(i).total_memory / 1024**3:.1f} GB')
    # Test basic GPU operation
    x = torch.randn(1000, 1000).cuda()
    y = torch.randn(1000, 1000).cuda()
    z = torch.mm(x, y)
    print(f'GPU computation test: {z.shape}')
    print('✅ Kaiwo-PoC GPU test successful!')
else:
    print('❌ No GPU available')
print('=== Kaiwo-PoC Environment ===')
print(f'Job name: {os.environ.get(\"KAIWO_JOB_NAME\", \"Not set\")}')
print(f'Replica index: {os.environ.get(\"KAIWO_REPLICA_INDEX\", \"Not set\")}')
"
